<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majestic - Card Reading Engine</title>
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    
    <style>
        /* ==========================================
           READING ENGINE BASE STYLES
           ========================================== */
        body {
            padding: 0;
            margin: 0;
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow-x: hidden;
        }
        
        /* When avatar view is active, body takes avatar background */
        body.avatar-active-olivia {
            background: linear-gradient(to bottom, #f0fdf4, #ffffff);
        }
        
        body.avatar-active-elijah {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        
        body.avatar-active-destiny {
            background: linear-gradient(to bottom, #1a2e2e 0%, #2d4a4a 50%, #3e5555 100%);
        }
        
        body.avatar-active-casper {
            background: linear-gradient(135deg, #1a0e0a 0%, #2d1810 50%, #4a2618 100%);
        }
        
        .container {
            padding: 20px;
        }

        .card-animation-container {
            display: none;
            padding: 60px 20px;
            text-align: center;
        }

        .card-animation-container.active {
            display: block;
        }

        .card-deck {
            position: relative;
            height: 400px;
            margin: 40px auto;
            max-width: 800px;
        }

        .card-deck .tarot-card {
            position: absolute;
        }

        .base-reading {
            display: none;
            padding: 40px 20px;
        }

        .base-reading.active {
            display: block;
        }

        .avatar-reading {
            display: none;
            padding: 40px 20px;
            min-height: 100vh;
            background: none; /* Body handles background */
        }

        .avatar-reading.active {
            display: block;
        }

/* ============================================
   AVATAR THEMES FOR READING ENGINE
   ============================================ */

/* ============================================
   OLIVIA (EARTH üåø)
   ============================================ */
.avatar-reading.olivia {
  /* Background handled by body.avatar-active-olivia */
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
  color: #2e7d32;
}

.avatar-reading.olivia .btn-primary,
.avatar-reading.olivia .send-btn {
  background: linear-gradient(135deg, #6b8e23, #556b2f);
  color: white;
  border: none;
  box-shadow: 0 4px 6px rgba(107, 142, 35, 0.3);
}

.avatar-reading.olivia .btn-primary:hover,
.avatar-reading.olivia .send-btn:hover {
  transform: scale(1.02);
  box-shadow: 0 6px 12px rgba(107, 142, 35, 0.4);
}

.avatar-reading.olivia .chip {
  background: rgba(240, 253, 244, 0.9);
  border: 1px solid rgba(107, 142, 35, 0.3);
  color: #2e7d32;
}

.avatar-reading.olivia .chip:hover {
  border-color: #6b8e23;
  background: rgba(107, 142, 35, 0.1);
  transform: translateX(5px);
}

.avatar-reading.olivia .message.user .message-bubble {
  background: linear-gradient(to bottom right, #8fbc8f, #6b8e23);
  color: white;
}

.avatar-reading.olivia .message.avatar .message-bubble {
  background: rgba(240, 253, 244, 0.95);
  border: 1px solid rgba(107, 142, 35, 0.2);
  color: #2e7d32;
}

.avatar-reading.olivia .input-field {
  background: rgba(240, 253, 244, 0.9);
  border: 2px solid rgba(107, 142, 35, 0.3);
  color: #2e7d32;
}

.avatar-reading.olivia .input-field:focus {
  border-color: #6b8e23;
  box-shadow: 0 0 0 3px rgba(107, 142, 35, 0.1);
}

/* ============================================
   ELIJAH (AIR üí®)
   ============================================ */
.avatar-reading.elijah {
  /* Background handled by body.avatar-active-elijah */
  font-family: 'Courier New', monospace;
  color: #e0e0e0;
}

.avatar-reading.elijah .btn-primary,
.avatar-reading.elijah .send-btn {
  background: linear-gradient(135deg, #a855f7, #ec4899);
  color: white;
  border: none;
  box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
  text-transform: lowercase;
}

.avatar-reading.elijah .btn-primary:hover,
.avatar-reading.elijah .send-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
}

.avatar-reading.elijah .chip {
  background: rgba(30, 30, 50, 0.8);
  border: 2px solid rgba(168, 85, 247, 0.3);
  color: #e0e0e0;
}

.avatar-reading.elijah .chip:hover {
  border-color: #a855f7;
  background: rgba(168, 85, 247, 0.1);
  box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
  transform: translateX(5px);
}

.avatar-reading.elijah .message.user .message-bubble {
  background: linear-gradient(135deg, #a855f7, #ec4899);
  color: white;
  box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
}

.avatar-reading.elijah .message.avatar .message-bubble {
  background: rgba(30, 30, 50, 0.8);
  border: 2px solid rgba(168, 85, 247, 0.3);
  box-shadow: 0 0 20px rgba(168, 85, 247, 0.2);
  color: #e0e0e0;
}

.avatar-reading.elijah .input-field {
  background: rgba(30, 30, 50, 0.8);
  border: 2px solid rgba(168, 85, 247, 0.3);
  color: #e0e0e0;
}

.avatar-reading.elijah .input-field:focus {
  border-color: #a855f7;
  box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
}

.avatar-reading.elijah .chips-label,
.avatar-reading.elijah .btn-primary,
.avatar-reading.elijah .chip-text {
  text-transform: lowercase;
}

/* Elijah glitch animation */
@keyframes glitch-elijah {
  0%, 90%, 100% { transform: translate(0); }
  92% { transform: translate(-2px, 2px); }
  94% { transform: translate(2px, -2px); }
  96% { transform: translate(-2px, -2px); }
  98% { transform: translate(2px, 2px); }
}

.avatar-reading.elijah .avatar-icon {
  animation: glitch-elijah 3s infinite;
}

/* ============================================
   DESTINY (WATER üåä)
   ============================================ */
.avatar-reading.destiny {
  /* Background handled by body.avatar-active-destiny */
  font-family: 'Georgia', 'Times New Roman', serif;
  color: #b2dfdb;
}

.avatar-reading.destiny .btn-primary,
.avatar-reading.destiny .send-btn {
  background: linear-gradient(135deg, #0d9488, #0f766e);
  color: white;
  border: none;
  box-shadow: 0 10px 30px rgba(13, 148, 136, 0.2);
}

.avatar-reading.destiny .btn-primary:hover,
.avatar-reading.destiny .send-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(13, 148, 136, 0.3);
}

.avatar-reading.destiny .chip {
  background: rgba(28, 45, 28, 0.9);
  border: 1px solid rgba(13, 148, 136, 0.3);
  color: #b2dfdb;
}

.avatar-reading.destiny .chip:hover {
  border-color: #0d9488;
  background: rgba(13, 148, 136, 0.1);
  transform: translateX(5px);
}

.avatar-reading.destiny .message.user .message-bubble {
  background: linear-gradient(135deg, #0d9488, #0f766e);
  color: white;
  box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
}

.avatar-reading.destiny .message.avatar .message-bubble {
  background: rgba(28, 45, 28, 0.9);
  border: 1px solid rgba(13, 148, 136, 0.2);
  color: #b2dfdb;
}

.avatar-reading.destiny .input-field {
  background: rgba(28, 45, 28, 0.9);
  border: 2px solid rgba(13, 148, 136, 0.3);
  color: #b2dfdb;
}

.avatar-reading.destiny .input-field:focus {
  border-color: #0d9488;
  box-shadow: 0 0 15px rgba(13, 148, 136, 0.2);
}

/* Destiny pulse animation */
@keyframes gentle-pulse-destiny {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.9; transform: scale(1.02); }
}

.avatar-reading.destiny .avatar-icon {
  animation: gentle-pulse-destiny 3s ease-in-out infinite;
}

/* ============================================
   CASPER (FIRE üî•)
   ============================================ */
.avatar-reading.casper {
  /* Background handled by body.avatar-active-casper */
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: #fdba74;
}

.avatar-reading.casper .btn-primary,
.avatar-reading.casper .send-btn {
  background: linear-gradient(135deg, #f97316, #dc2626);
  color: white;
  border: none;
  box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.avatar-reading.casper .btn-primary:hover,
.avatar-reading.casper .send-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 12px 32px rgba(249, 115, 22, 0.6);
}

.avatar-reading.casper .chip {
  background: rgba(42, 20, 14, 0.9);
  border: 2px solid rgba(249, 115, 22, 0.3);
  color: #fdba74;
  font-weight: 600;
}

.avatar-reading.casper .chip:hover {
  border-color: #f97316;
  background: rgba(249, 115, 22, 0.1);
  box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);
  transform: translateX(5px);
}

.avatar-reading.casper .message.user .message-bubble {
  background: linear-gradient(135deg, #f97316, #dc2626);
  color: white;
  box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
  font-weight: 600;
}

.avatar-reading.casper .message.avatar .message-bubble {
  background: rgba(42, 20, 14, 0.9);
  border: 2px solid rgba(249, 115, 22, 0.3);
  color: #fdba74;
}

.avatar-reading.casper .input-field {
  background: rgba(42, 20, 14, 0.9);
  border: 2px solid rgba(249, 115, 22, 0.3);
  color: #fdba74;
  font-weight: 600;
}

.avatar-reading.casper .input-field:focus {
  border-color: #f97316;
  box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);
}

.avatar-reading.casper .chips-label,
.avatar-reading.casper .chip-text,
.avatar-reading.casper h2,
.avatar-reading.casper h3,
.avatar-reading.casper h4 {
  text-transform: uppercase;
}

/* Casper fire pulse animation */
@keyframes fire-pulse-casper {
  0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
  50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(249, 115, 22, 0.6); }
}

.avatar-reading.casper .avatar-icon {
  animation: fire-pulse-casper 2s ease-in-out infinite;
}

/* ============================================
   SHARED "EXPLORE FURTHER" STYLES
   (Applied to all avatar readings)
   ============================================ */
.avatar-reading .chips-section {
  margin-top: 2rem;
  padding: 1rem 0;
}

.avatar-reading .chips-label {
  text-align: center;
  font-size: 0.875rem;
  margin-bottom: 0.75rem;
  opacity: 0.8;
  font-weight: 500;
}

.avatar-reading .chip {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.875rem 1.25rem;
  margin-bottom: 0.75rem;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  font-size: 0.9375rem;
}

.avatar-reading .chip-icon {
  font-size: 1.25rem;
  flex-shrink: 0;
}

.avatar-reading .chip-text {
  flex: 1;
}

.avatar-reading .conversation-view {
  display: flex;
  flex-direction: column;
  min-height: 70vh;
  padding: 1rem 0;
}

.avatar-reading .conversation-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.avatar-reading .xp-display {
  text-align: right;
  font-size: 0.875rem;
  font-weight: 600;
}

.avatar-reading .conversation-thread {
  flex: 1;
  overflow-y: auto;
  margin-bottom: 1rem;
  padding: 0.5rem 0;
}

.avatar-reading .context-card {
  text-align: center;
  padding: 1rem;
  border-radius: 0.75rem;
  margin-bottom: 1.5rem;
  font-size: 0.875rem;
  opacity: 0.8;
}

.avatar-reading .message {
  display: flex;
  margin-bottom: 1rem;
  animation: fadeInUp 0.3s ease;
}

.avatar-reading .message.user {
  justify-content: flex-end;
}

.avatar-reading .message.avatar {
  justify-content: flex-start;
}

.avatar-reading .message-bubble {
  max-width: 80%;
  padding: 1rem;
  border-radius: 1rem;
  line-height: 1.6;
}

.avatar-reading .message.user .message-bubble {
  border-radius: 1rem 1rem 0.25rem 1rem;
}

.avatar-reading .message.avatar .message-bubble {
  border-radius: 1rem 1rem 1rem 0.25rem;
}

.avatar-reading .message-text {
  font-size: 0.9375rem;
  margin-bottom: 0;
  white-space: pre-line;
}

.avatar-reading .xp-badge {
  font-size: 0.75rem;
  margin-top: 0.5rem;
  font-weight: 600;
  color: #fbbf24;
  opacity: 0.9;
}

.avatar-reading .input-area {
  display: flex;
  gap: 0.5rem;
  padding: 1rem 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.avatar-reading .input-field {
  flex: 1;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  font-size: 0.9375rem;
  outline: none;
  transition: all 0.3s ease;
}

.avatar-reading .input-field::placeholder {
  opacity: 0.5;
}

.avatar-reading .send-btn {
  width: 3rem;
  height: 3rem;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.25rem;
  font-weight: bold;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Hide conversation initially */
.avatar-reading .conversation-view {
  display: none;
}

.avatar-reading .conversation-view.active {
  display: flex;
}

/* Hide interpretation when conversation active */
.avatar-reading.conversation-active .interpretation-view {
  display: none;
}
/* Additional heading and container styles for all avatars */

/* OLIVIA */
.avatar-reading.olivia h2,
.avatar-reading.olivia h3,
.avatar-reading.olivia h4 {
  color: #2e7d32;
}

.avatar-reading.olivia .card-container,
.avatar-reading.olivia .interpretation-section {
  background: rgba(240, 253, 244, 0.95);
  border: 1px solid rgba(107, 142, 35, 0.2);
}

/* DESTINY */
.avatar-reading.destiny h2,
.avatar-reading.destiny h3,
.avatar-reading.destiny h4 {
  color: #5eead4;
  text-shadow: 0 0 10px rgba(94, 234, 212, 0.3);
}

.avatar-reading.destiny .card-container,
.avatar-reading.destiny .interpretation-section {
  background: rgba(28, 45, 28, 0.9);
  border: 1px solid rgba(13, 148, 136, 0.3);
}

/* CASPER */
.avatar-reading.casper h2,
.avatar-reading.casper h3,
.avatar-reading.casper h4 {
  color: #fdba74;
  text-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
  text-transform: uppercase;
}

.avatar-reading.casper .card-container,
.avatar-reading.casper .interpretation-section {
  background: rgba(42, 20, 14, 0.9);
  border: 2px solid rgba(249, 115, 22, 0.3);

/* ==========================================
   CARD DISPLAY STYLES FOR ALL AVATARS
   ========================================== */

/* Shared card display structure */
.avatar-reading .card-display {
  width: 16rem;
  height: 24rem;
  border-radius: 1rem;
  margin: 2rem auto;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  position: relative;
  overflow: hidden;
}

.avatar-reading .card-display::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: shimmer-card 3s infinite;
}

@keyframes shimmer-card {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.avatar-reading .card-content {
  text-align: center;
  color: white;
  z-index: 1;
}

.avatar-reading .card-number {
  font-size: 5rem;
  margin-bottom: 1rem;
  font-weight: bold;
  text-shadow: 0 0 20px rgba(255,255,255,0.5);
}

.avatar-reading .card-name {
  font-size: 1.5rem;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-shadow: 0 0 10px rgba(255,255,255,0.5);
  text-transform: uppercase;
}

/* Olivia card display */
.avatar-reading.olivia .card-display {
  background: linear-gradient(135deg, #8fbc8f, #6b8e23);
  border: 2px solid #6b8e23;
}

/* Elijah card display */
.avatar-reading.elijah .card-display {
  background: linear-gradient(135deg, #667eea, #764ba2);
  border: 2px solid #a855f7;
}

/* Destiny card display */
.avatar-reading.destiny .card-display {
  background: linear-gradient(135deg, #0d9488, #0f766e);
  border: 2px solid #5eead4;
}

/* Casper card display */
.avatar-reading.casper .card-display {
  background: linear-gradient(135deg, #f97316, #dc2626);
  border: 2px solid #fdba74;
}

/* Card info section below card */
.avatar-reading .card-info {
  text-align: center;
  margin: 1rem 0;
}

.avatar-reading .card-info h3 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  letter-spacing: 0.1em;
}

.avatar-reading .card-info p {
  font-size: 0.875rem;
  opacity: 0.8;
}

/* Keywords display */
.avatar-reading .keywords {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  margin: 1rem 0;
}

.avatar-reading .keyword {
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  font-size: 0.75rem;
  opacity: 0.8;
}

.avatar-reading.olivia .keyword {
  background: rgba(107, 142, 35, 0.2);
  border: 1px solid rgba(107, 142, 35, 0.3);
}

.avatar-reading.elijah .keyword {
  background: rgba(168, 85, 247, 0.2);
  border: 1px solid rgba(168, 85, 247, 0.3);
}

.avatar-reading.destiny .keyword {
  background: rgba(13, 148, 136, 0.2);
  border: 1px solid rgba(13, 148, 136, 0.3);
}

.avatar-reading.casper .keyword {
  background: rgba(249, 115, 22, 0.2);
  border: 1px solid rgba(249, 115, 22, 0.3);
}
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Avatar Grid -->
        <div class="avatar-grid" id="avatarGrid"></div>

        <!-- Reading Type Selection -->
        <div class="reading-types" id="readingTypes"></div>

        <!-- Card Animation Container -->
        <div class="card-animation-container" id="cardAnimation">
            <div class="card-deck" id="cardDeck"></div>
        </div>

        <!-- Base Reading Display -->
        <div class="base-reading" id="baseReading">
            <button class="btn back-btn" onclick="resetToSelectionView()">‚Üê Back to Reading Types</button>
            <div id="baseReadingContent"></div>
        </div>

        <!-- Avatar Reading View -->
        <div class="avatar-reading" id="avatarReading">
            <button class="btn back-btn" onclick="backToBaseView()">‚Üê Back to Base Reading</button>
            <div id="avatarReadingContent"></div>
        </div>
    </div>

    <!-- Shared Scripts -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/state.js"></script>
    <script src="../assets/js/components.js"></script>
    <script src="../assets/js/api.js"></script>

    <!-- Page Logic -->
    <script>
        // ========================================
        // INITIALIZATION
        // ========================================

        function init() {
            renderAvatarGrid();
            renderReadingTypes();
        }

        function renderAvatarGrid() {
            var grid = document.getElementById('avatarGrid');
            var avatars = ['olivia', 'elijah', 'destiny', 'casper'];
            
            avatars.forEach(function(key) {
                var avatar = AVATAR_CONFIGS[key];
                grid.innerHTML += renderAvatarCard(key, avatar, true);
            });
        }

        function renderReadingTypes() {
            var container = document.getElementById('readingTypes');
            var types = [
                { key: 'daily', icon: 'üìÖ', title: 'Daily Card', subtitle: 'Today\'s guidance' },
                { key: 'birth', icon: 'ü™ê', title: 'Birth Card', subtitle: 'Your soul\'s blueprint' },
                { key: 'threeCard', icon: 'üîÆ', title: 'Three-Card Reading', subtitle: 'Past ¬∑ Present ¬∑ Future' },
                { key: 'jumping', icon: '‚ú®', title: 'Jumping Card Spread', subtitle: 'Three cards + special guidance' }
            ];
            
            types.forEach(function(type) {
                container.innerHTML += renderReadingTypeCard(type);
            });
        }

        // ========================================
        // READING FLOW
        // ========================================

        function selectReading(readingType) {
            setReading(readingType);
            
            document.getElementById('readingTypes').style.display = 'none';
            
            var animationContainer = document.getElementById('cardAnimation');
            animationContainer.classList.add('active');
            
            animateCards(readingType);
            
            setTimeout(function() {
                animationContainer.classList.remove('active');
                showBaseReading(readingType);
            }, 3000);
        }

        function animateCards(readingType) {
            var deck = document.getElementById('cardDeck');
            deck.innerHTML = '';
            
            var data = CARDS[readingType];
            
            if (readingType === 'daily' || readingType === 'birth') {
                var card = document.createElement('div');
                card.className = 'tarot-card dealt';
                card.textContent = data.card.emoji;
                card.style.left = '50%';
                card.style.top = '50%';
                card.style.transform = 'translateX(-50%) translateY(-50%)';
                deck.appendChild(card);
            } else {
                var positions = [
                    { left: '15%', top: '50%' },
                    { left: '50%', top: '50%' },
                    { left: '85%', top: '50%' }
                ];
                
                data.cards.forEach(function(cardData, index) {
                    setTimeout(function() {
                        var card = document.createElement('div');
                        card.className = 'tarot-card dealt';
                        card.textContent = cardData.emoji;
                        card.style.left = positions[index].left;
                        card.style.top = positions[index].top;
                        card.style.transform = 'translateX(-50%) translateY(-50%)';
                        deck.appendChild(card);
                    }, index * 400);
                });
                
                if (readingType === 'jumping') {
                    setTimeout(function() {
                        var jumpCard = document.createElement('div');
                        jumpCard.className = 'tarot-card jumping';
                        jumpCard.textContent = data.jumpingCard.emoji;
                        jumpCard.style.left = '50%';
                        jumpCard.style.top = '80%';
                        jumpCard.style.transform = 'translateX(-50%)';
                        deck.appendChild(jumpCard);
                    }, 1600);
                }
            }
        }

        function showBaseReading(readingType) {
            var data = CARDS[readingType];
            var baseReading = document.getElementById('baseReading');
            var content = document.getElementById('baseReadingContent');
            
            baseReading.classList.add('active');
            content.innerHTML = '';
            
            // Enable avatar selection
            var avatarCards = document.querySelectorAll('.avatar-card');
            for (var i = 0; i < avatarCards.length; i++) {
                avatarCards[i].classList.remove('disabled');
            }
            
            // Display cards
            var cardsHTML = '<div class="cards-display">';
            if (readingType === 'daily') {
                cardsHTML += renderCard(data.card.emoji, data.card.name);
            } else if (readingType === 'birth') {
                cardsHTML += renderCard(data.card.emoji, data.card.name + '<br>Birth Date: ' + data.birthdate);
            } else {
                data.cards.forEach(function(card) {
                    cardsHTML += renderCard(card.emoji, card.name, card.position);
                });
            }
            cardsHTML += '</div>';
            
            content.innerHTML = cardsHTML + renderInterpretation('Base Interpretation', data.base.text, data.base.points);
            
            // Jumping card section
            if (readingType === 'jumping') {
                content.innerHTML += renderJumpingCardContainer(
                    data.jumpingCard,
                    data.base.jumpingGuidance,
                    data.base.jumpingPoints
                );
            }
        }

        function handleAvatarClick(avatar) {
            var clickedCard = event.currentTarget;
            if (!clickedCard.classList.contains('disabled')) {
                selectAvatar(avatar, clickedCard);
            }
        }

        function selectAvatar(avatar, clickedCard) {
            setAvatar(avatar);
            
            // Update avatar selection UI
            var avatarCards = document.querySelectorAll('.avatar-card');
            for (var i = 0; i < avatarCards.length; i++) {
                avatarCards[i].classList.remove('selected');
            }
            clickedCard.classList.add('selected');
            
            // Show avatar reading
            document.getElementById('baseReading').classList.remove('active');
            showAvatarReading(avatar);
        }

        function showAvatarReading(avatar) {
            var state = getState();
            var avatarConfig = AVATAR_CONFIGS[avatar];
            var cardData = CARDS[state.currentReading];
            var reading = getAvatarReading(state.currentReading, avatar);
            
            var avatarReading = document.getElementById('avatarReading');
            var content = document.getElementById('avatarReadingContent');
            
            // Apply avatar class to both container and body
            avatarReading.className = 'avatar-reading ' + avatar + ' active';
            document.body.className = 'avatar-active-' + avatar;
            
            // Build content
            var html = renderAvatarHeader(avatarConfig);
            
            // Display cards with proper card-display structure
            if (state.currentReading === 'daily' || state.currentReading === 'birth') {
                html += '<div class="card-display">';
                html += '<div class="card-content">';
                html += '<p class="card-number">' + cardData.card.emoji + '</p>';
                html += '<p class="card-name">' + cardData.card.name + '</p>';
                html += '</div></div>';
                
                html += '<div class="card-info">';
                html += '<h3>' + cardData.card.name + '</h3>';
                if (state.currentReading === 'birth') {
                    html += '<p>Birth Date: ' + cardData.birthdate + '</p>';
                }
                html += '</div>';
            } else {
                html += '<div class="cards-display">';
                cardData.cards.forEach(function(card) {
                    html += renderCard(card.emoji, card.name, card.position);
                });
                html += '</div>';
            }
            
            // Avatar interpretation
            html += renderInterpretation(reading.title, reading.text, reading.points);
            
            // Music note
            html += renderMusicNote(reading.music);
            
            // Jumping card special message
            if (state.currentReading === 'jumping') {
                html += '<div class="jumping-card-container">';
                html += '<h3 class="jumping-card-label">‚ö° Special Message ‚ö°</h3>';
                html += '<div class="interpretation-section">';
                html += '<p class="interpretation-text">' + reading.jumpingText + '</p>';
                html += '</div></div>';
            }
            
            // Initialize conversation state for this avatar
            conversationState.currentAvatar = avatar;
            conversationState.stage = 'interpretation';
            conversationState.conversation = [];
            conversationState.relationshipXP = 0;
            
            // Add "Explore Further" chips section
            html += renderChipsSection(avatar);
            
            content.innerHTML = html;
        }

        function backToBaseView() {
            document.getElementById('avatarReading').classList.remove('active');
            document.getElementById('baseReading').classList.add('active');
            document.body.className = ''; // Clear avatar body styling
        }

        function resetToSelectionView() {
            document.getElementById('baseReading').classList.remove('active');
            document.getElementById('avatarReading').classList.remove('active');
            document.getElementById('readingTypes').style.display = 'grid';
            document.body.className = ''; // Clear avatar body styling
            
            var avatarCards = document.querySelectorAll('.avatar-card');
            for (var i = 0; i < avatarCards.length; i++) {
                avatarCards[i].classList.add('disabled');
                avatarCards[i].classList.remove('selected');
            }
            
            resetToSelection();
        }

        // ========================================
        // ========================================
        // EXPLORE FURTHER - CONVERSATION FUNCTIONALITY
        // ========================================

        // Conversation state
        var conversationState = {
            stage: 'interpretation', // 'interpretation' or 'conversation'
            conversation: [],
            relationshipXP: 0,
            currentAvatar: null
        };

        // Question chips for each avatar
        var avatarQuestionChips = {
            olivia: [
                { id: 'love', text: "What does this mean for love?", icon: 'üå∏' },
                { id: 'stuck', text: "I feel stuck though...", icon: 'üåæ' },
                { id: 'career', text: "How does this apply to my career?", icon: 'üå≥' }
            ],
            elijah: [
                { id: 'love', text: "What about love?", icon: 'üí≠' },
                { id: 'stuck', text: "I'm feeling stuck...", icon: 'üåÄ' },
                { id: 'career', text: "Career implications?", icon: '‚ö°' }
            ],
            destiny: [
                { id: 'love', text: "How does this apply to relationships?", icon: 'üíß' },
                { id: 'stuck', text: "I'm feeling uncertain...", icon: 'üå±' },
                { id: 'career', text: "What about my career path?", icon: 'üçÉ' }
            ],
            casper: [
                { id: 'love', text: "What about love?", icon: 'üî•' },
                { id: 'stuck', text: "I'm stuck. Help.", icon: '‚ö°' },
                { id: 'career', text: "Career application?", icon: 'üéØ' }
            ]
        };

        // Responses for each avatar (generic responses for all reading types)
        var avatarResponses = {
            olivia: {
                love: {
                    message: "When it comes to love and relationships, this card suggests clarity about what you want. It's about moving toward connection with intention rather than waiting passively. The key is balancing your vision with staying present to what's actually unfolding. Are you trying to control the outcome instead of letting things breathe?",
                    xp: 2
                },
                stuck: {
                    message: "I hear that. Getting guidance about movement when you feel stuck can be frustrating. Here's what I'll say: sometimes the movement isn't external yet‚Äîit's about internal resolve. Deciding something, even if you can't act on it immediately. What's really keeping you stuck right now?",
                    xp: 3
                },
                career: {
                    message: "Professionally, this energy is about taking initiative and driving things forward. It's strong for leadership moments, pitching ideas, or navigating competitive situations. The question becomes: what would it look like to stop waiting for permission and start steering? Just be mindful not to burn out your team in the process.",
                    xp: 2
                }
            },
            elijah: {
                love: {
                    message: "okay so this card in love is FASCINATING because it's about directed energy, right? not the passive \\\"let's see what happens\\\" vibe but the active \\\"here's what I want and I'm moving toward it\\\" energy. the trick is‚Äîand this is where it gets interesting‚Äîknowing when to drive and when to let the other person steer for a bit. does that make sense for where you're at?",
                    xp: 2
                },
                stuck: {
                    message: "oof yeah that's the WORST. getting a movement card when you feel like you're in cement. but here's where it gets interesting: this card isn't always about external movement. sometimes it's about *internal alignment*. like, you can't move forward until you know which direction you're actually facing. what if being stuck is actually... information?",
                    xp: 3
                },
                career: {
                    message: "professionally this is about taking the wheel and DRIVING. like not just participating but leading. pitching. deciding. the shadow side? you can get so focused on your vision that you steamroll everyone else. but if you're feeling stuck at work, this card is basically saying: what would happen if you just... started steering?",
                    xp: 2
                }
            },
            destiny: {
                love: {
                    message: "In matters of connection, this card invites examination of how you navigate closeness with clarity of purpose. It asks: are you moving toward what you desire, or are you gripping tightly to a specific outcome? The framework: directed energy requires both vision and flexibility. Where might you need to loosen your grip while maintaining your direction?",
                    xp: 2
                },
                stuck: {
                    message: "Uncertainty is information. Let's work with it rather than against it. This card appearing during a period of feeling stuck suggests you may be waiting for perfect clarity before taking action. But here's what I observe: clarity often emerges through movement, not before it. A useful framework: 1) Identify what you DO know, 2) Take the smallest possible step, 3) Observe what shifts. What's one thing you know for certain right now?",
                    xp: 3
                },
                career: {
                    message: "Professionally, this energy speaks to leadership through clear vision and sustained effort. It's particularly resonant for moments requiring you to chart a course through complexity. The invitation: lead with clarity while remaining responsive to feedback. The caution: rigidity in pursuit of your vision can create isolation. How might you hold both direction and receptivity?",
                    xp: 2
                }
            },
            casper: {
                love: {
                    message: "In relationships: this means KNOW WHAT YOU WANT and MOVE TOWARD IT. No games. No waiting around. You want clarity? CREATE IT. Ask the question. Make the move. The trap: being so focused on where you're going that you miss what's actually happening. Check in: are you driving together or are you just driving?",
                    xp: 2
                },
                stuck: {
                    message: "Stuck? Good. Let's fix it. First: are you actually stuck, or are you just scared to move? Because this card showing up means the path is there. You might not like the path. It might be hard. But it's there. Here's your assignment: ‚ñ∏ Write down the three actions you KNOW you should take ‚ñ∏ Pick the smallest one ‚ñ∏ Do it today. Not tomorrow. TODAY.",
                    xp: 3
                },
                career: {
                    message: "Career: TAKE THE WHEEL. Stop asking permission. Stop waiting for the \\\"right moment\\\". The moment is now. Pitch the idea. Lead the project. Make the decision. You know what needs to happen. The only question is: are you going to do it or keep waiting? Warning: don't run over your team on the way there.",
                    xp: 2
                }
            }
        };

        // Get chips label for avatar
        function getChipsLabel(avatar) {
            var labels = {
                olivia: 'ask me anything about this card',
                elijah: 'got questions? hit me',
                destiny: 'Explore Further',
                casper: 'ask me anything about this card'
            };
            return labels[avatar] || 'Explore Further';
        }

        // Handle chip click
        function handleChipClick(chipId) {
            var avatar = conversationState.currentAvatar;
            var chip = avatarQuestionChips[avatar].find(function(c) { return c.id === chipId; });
            var response = avatarResponses[avatar][chipId];
            
            // Add messages to conversation
            conversationState.conversation.push(
                { speaker: 'user', text: chip.text },
                { speaker: 'avatar', text: response.message, xp: response.xp }
            );
            conversationState.relationshipXP += response.xp;
            
            // Switch to conversation view
            conversationState.stage = 'conversation';
            renderConversationView();
        }

        // Send custom message
        function sendMessage() {
            var input = document.getElementById('messageInput');
            var message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            conversationState.conversation.push({ speaker: 'user', text: message });
            input.value = '';
            renderConversationView();
            
            // Simulate avatar response
            setTimeout(function() {
                var genericResponse = "That's a thoughtful question. The energy of this card invites you to consider how you might take more intentional action in this area of your life.";
                conversationState.conversation.push({
                    speaker: 'avatar',
                    text: genericResponse,
                    xp: 1
                });
                conversationState.relationshipXP += 1;
                renderConversationView();
            }, 1000);
        }

        // Go back to interpretation view
        function backToInterpretation() {
            conversationState.stage = 'interpretation';
            conversationState.conversation = [];
            
            // Re-render the avatar reading
            var state = getState();
            showAvatarReading(state.currentAvatar);
        }

        // Render conversation view
        function renderConversationView() {
            var avatar = conversationState.currentAvatar;
            var avatarConfig = AVATAR_CONFIGS[avatar];
            var state = getState();
            var cardData = CARDS[state.currentReading];
            
            var html = '';
            
            // Header with back button and XP
            html += '<div class="conversation-header">';
            html += '<button class="btn" onclick="backToInterpretation()">‚Üê Back</button>';
            html += '<div class="xp-display">Relationship XP<br><strong>' + conversationState.relationshipXP + '</strong></div>';
            html += '</div>';
            
            // Context card showing which card is being discussed
            var cardName = '';
            if (state.currentReading === 'daily' || state.currentReading === 'birth') {
                cardName = cardData.card.name;
            } else {
                cardName = cardData.cards.map(function(c) { return c.name; }).join(', ');
            }
            
            html += '<div class="context-card" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">';
            html += '<p style="margin: 0; font-size: 0.75rem; opacity: 0.7;">Your Card</p>';
            html += '<p style="margin: 0.25rem 0 0 0; font-weight: 600;">' + cardName + '</p>';
            html += '</div>';
            
            // Conversation thread
            html += '<div class="conversation-thread">';
            conversationState.conversation.forEach(function(msg) {
                var messageClass = msg.speaker === 'user' ? 'user' : 'avatar';
                html += '<div class="message ' + messageClass + '">';
                html += '<div class="message-bubble">';
                html += '<p class="message-text">' + msg.text + '</p>';
                if (msg.xp) {
                    html += '<p class="xp-badge">+' + msg.xp + ' XP</p>';
                }
                html += '</div></div>';
            });
            html += '</div>';
            
            // Remaining chips (if any)
            var answeredChipIds = conversationState.conversation
                .filter(function(m) { return m.speaker === 'user'; })
                .map(function(m) {
                    // Match message text to chip
                    return avatarQuestionChips[avatar].find(function(c) { 
                        return c.text === m.text; 
                    })?.id;
                })
                .filter(Boolean);
            
            var remainingChips = avatarQuestionChips[avatar].filter(function(chip) {
                return !answeredChipIds.includes(chip.id);
            });
            
            if (remainingChips.length > 0) {
                html += '<div class="chips-section" style="margin-bottom: 1rem;">';
                remainingChips.forEach(function(chip) {
                    html += '<button class="chip" onclick="handleChipClick(\'' + chip.id + '\')">';
                    html += '<span class="chip-icon">' + chip.icon + '</span>';
                    html += '<span class="chip-text">' + chip.text + '</span>';
                    html += '</button>';
                });
                html += '</div>';
            }
            
            // Input area
            html += '<div class="input-area">';
            html += '<input type="text" id="messageInput" class="input-field" placeholder="Share your thoughts..." onkeypress="if(event.key===\'Enter\') sendMessage()">';
            html += '<button class="send-btn" onclick="sendMessage()">‚û§</button>';
            html += '</div>';
            
            document.getElementById('avatarReadingContent').innerHTML = html;
        }

        // Render chips section for interpretation view
        function renderChipsSection(avatar) {
            var chips = avatarQuestionChips[avatar];
            var label = getChipsLabel(avatar);
            
            var html = '<div class="chips-section">';
            html += '<p class="chips-label">' + label + '</p>';
            chips.forEach(function(chip) {
                html += '<button class="chip" onclick="handleChipClick(\'' + chip.id + '\')">';
                html += '<span class="chip-icon">' + chip.icon + '</span>';
                html += '<span class="chip-text">' + chip.text + '</span>';
                html += '</button>';
            });
            html += '</div>';
            
            return html;
        }
        // START APP
        // ========================================
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
