<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Majestic - Casper First Reading</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #1a0e0a 0%, #2d1810 50%, #4a2618 100%);
      min-height: 100vh;
      color: #f5f5f5;
    }

    .container {
      padding: 3rem 1.5rem;
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 2rem;
    }

    .avatar-icon {
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      background: linear-gradient(135deg, #f97316, #dc2626);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 0 30px rgba(249, 115, 22, 0.6);
    }

    .avatar-info h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #fb923c;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .avatar-info p {
      font-size: 0.875rem;
      color: #d4d4d8;
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .message-box {
      background: rgba(20, 10, 5, 0.8);
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 0 30px rgba(249, 115, 22, 0.2);
      border-left: 4px solid #f97316;
      margin-bottom: 2rem;
    }

    .message-box p {
      color: #f5f5f5;
      line-height: 1.8;
      margin-bottom: 1rem;
    }

    .message-box p:last-child {
      margin-bottom: 0;
    }

    .message-box strong {
      color: #fb923c;
      font-weight: 700;
    }

    .btn-primary {
      width: 100%;
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      padding: 1rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      box-shadow: 0 4px 20px rgba(249, 115, 22, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(249, 115, 22, 0.6);
    }

    .card-display {
      width: 16rem;
      height: 24rem;
      background: linear-gradient(135deg, #f97316, #dc2626);
      border-radius: 0.5rem;
      margin: 0 auto 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      border: 3px solid #fb923c;
    }

    .card-content {
      text-align: center;
      color: white;
    }

    .card-number {
      font-size: 5rem;
      margin-bottom: 1rem;
      font-weight: 900;
    }

    .card-name {
      font-size: 1.5rem;
      font-weight: 900;
      letter-spacing: 0.2em;
    }

    .card-info {
      text-align: center;
      margin-bottom: 2rem;
    }

    .card-info h3 {
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 0.5rem;
      color: #fb923c;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .keywords {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .keyword {
      padding: 0.5rem 1rem;
      background: rgba(249, 115, 22, 0.2);
      color: #fdba74;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      border: 1px solid rgba(249, 115, 22, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 700;
    }

    .shuffling-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .shuffling-card {
      width: 8rem;
      height: 12rem;
      background: linear-gradient(135deg, #f97316, #dc2626);
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      animation: pulse-fire 1.5s infinite;
      border: 3px solid #fb923c;
    }

    @keyframes pulse-fire {
      0%, 100% { 
        opacity: 1; 
        box-shadow: 0 20px 40px rgba(249, 115, 22, 0.6);
      }
      50% { 
        opacity: 0.7;
        box-shadow: 0 20px 60px rgba(249, 115, 22, 0.4);
      }
    }

    .shuffling-text {
      color: #fb923c;
      animation: pulse 1.5s infinite;
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.2em;
    }

    .mini-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: rgba(20, 10, 5, 0.8);
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 0 20px rgba(249, 115, 22, 0.2);
      border-left: 4px solid #f97316;
      margin-bottom: 1.5rem;
    }

    .mini-card-img {
      width: 4rem;
      height: 6rem;
      background: linear-gradient(135deg, #f97316, #dc2626);
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      font-weight: 900;
      border: 2px solid #fb923c;
    }

    .mini-card-info h3 {
      font-weight: 700;
      color: #fb923c;
      text-transform: uppercase;
    }

    .mini-card-info p {
      font-size: 0.875rem;
      color: #d4d4d8;
    }

    .interpretation-box {
      background: rgba(20, 10, 5, 0.8);
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 0 30px rgba(249, 115, 22, 0.2);
      border-left: 4px solid #f97316;
      margin-bottom: 1.5rem;
    }

    .casper-message {
      color: #f5f5f5;
      line-height: 1.8;
    }

    .casper-message h4 {
      color: #fb923c;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      letter-spacing: 0.1em;
    }

    .casper-message ul {
      list-style: none;
      margin: 0.75rem 0;
      padding: 0;
    }

    .casper-message li {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
    }

    .casper-message li:before {
      content: '‚ñ∏';
      position: absolute;
      left: 0;
      color: #fb923c;
      font-weight: 900;
    }

    .action-box {
      background: rgba(249, 115, 22, 0.15);
      border: 2px solid #f97316;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
    }

    .action-box strong {
      color: #fb923c;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      display: block;
      margin-bottom: 0.5rem;
    }

    .strengths-box {
      background: rgba(20, 10, 5, 0.8);
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 0 20px rgba(249, 115, 22, 0.2);
      border-left: 4px solid #f97316;
      margin-bottom: 1.5rem;
    }

    .strengths-box h4 {
      font-weight: 700;
      color: #fb923c;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 0.9rem;
    }

    .item {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: rgba(249, 115, 22, 0.05);
      border-radius: 0.25rem;
      border-left: 3px solid #f97316;
    }

    .item:last-child {
      margin-bottom: 0;
    }

    .item-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .item-header .symbol {
      font-size: 1.2rem;
    }

    .item-header p {
      font-weight: 700;
      color: #fdba74;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin: 0;
    }

    .item-content p {
      color: #d4d4d8;
      font-size: 0.85rem;
      line-height: 1.5;
      margin: 0;
    }

    .affirmation-box {
      background: linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(220, 38, 38, 0.3));
      border-radius: 0.5rem;
      padding: 2rem;
      box-shadow: 0 0 40px rgba(249, 115, 22, 0.3);
      margin-bottom: 1.5rem;
      border: 2px solid #f97316;
    }

    .affirmation-box p {
      color: white;
      text-align: center;
      font-weight: 700;
      line-height: 1.6;
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .chips-section {
      margin-top: auto;
    }

    .chips-label {
      color: #d4d4d8;
      font-size: 0.875rem;
      text-align: center;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 600;
    }

    .chip {
      width: 100%;
      background: rgba(20, 10, 5, 0.8);
      border: 2px solid rgba(249, 115, 22, 0.3);
      border-radius: 0.5rem;
      padding: 0.75rem 1.25rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .chip:hover {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.2);
      transform: translateX(5px);
    }

    .chip-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .chip-text {
      color: #f5f5f5;
      font-weight: 600;
    }

    .conversation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .xp-display {
      text-align: right;
    }

    .xp-display p:first-child {
      font-size: 0.875rem;
      color: #d4d4d8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .xp-display p:last-child {
      font-size: 1.125rem;
      font-weight: 900;
      color: #fb923c;
    }

    .conversation-thread {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 1rem;
    }

    .context-card {
      background: rgba(20, 10, 5, 0.8);
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 0 20px rgba(249, 115, 22, 0.2);
      border-left: 4px solid #f97316;
      text-align: center;
      margin-bottom: 1rem;
    }

    .context-card p:first-child {
      font-size: 0.875rem;
      color: #d4d4d8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .context-card p:last-child {
      font-weight: 700;
      color: #fb923c;
      text-transform: uppercase;
    }

    .message {
      margin-bottom: 1rem;
      display: flex;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.casper {
      justify-content: flex-start;
    }

    .message-bubble {
      max-width: 80%;
      border-radius: 0.5rem;
      padding: 1rem;
    }

    .message.user .message-bubble {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
    }

    .message.casper .message-bubble {
      background: rgba(20, 10, 5, 0.8);
      border-left: 4px solid #f97316;
    }

    .message-text {
      font-size: 0.875rem;
      line-height: 1.6;
    }

    .message.casper .message-text {
      color: #f5f5f5;
    }

    .xp-badge {
      font-size: 0.75rem;
      color: #fb923c;
      margin-top: 0.5rem;
      font-weight: 700;
    }

    .input-area {
      display: flex;
      gap: 0.5rem;
    }

    .input-field {
      flex: 1;
      background: rgba(20, 10, 5, 0.8);
      border: 2px solid rgba(249, 115, 22, 0.3);
      border-radius: 0.5rem;
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      outline: none;
      color: #f5f5f5;
    }

    .input-field:focus {
      border-color: #f97316;
    }

    .send-btn {
      width: 3rem;
      height: 3rem;
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      border: none;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1.2rem;
      font-weight: 900;
    }

    .send-btn:hover {
      transform: scale(1.1);
    }

    .scrollable {
      overflow-y: auto;
      flex: 1;
    }

    .back-button {
      background: transparent;
      border: none;
      color: #d4d4d8;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
      margin-bottom: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .back-button:hover {
      color: #fb923c;
      transform: translateX(-5px);
    }

    .back-button span:last-child {
      font-size: 0.75rem;
    }

    .save-button {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: rgba(20, 10, 5, 0.9);
      border: 2px solid #f97316;
      color: #fb923c;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 1000;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .save-button:hover {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      transform: scale(1.05);
    }

    .save-button.saved {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
    }

    .save-icon {
      font-size: 1rem;
    }

    @media (max-width: 640px) {
      .save-button {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <a href="chariot-showcase.html" style="position: fixed; top: 1rem; left: 1rem; background: rgba(255, 107, 53, 0.9); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; font-weight: 700; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.05em;" onmouseover="this.style.background='#ff6b35'; this.style.transform='translateX(-3px)'" onmouseout="this.style.background='rgba(255, 107, 53, 0.9)'; this.style.transform='translateX(0)'">
    <span style="font-size: 1.2rem;">‚Üê</span>
    <span>Back</span>
  </a>

  <script>
    // State
    let stage = 'welcome';
    let conversation = [];
    let relationshipXP = 0;
    let userMessage = '';
    let isFirstTime = true;
    let isSaved = false;

    // Data
    const drawnCard = {
      id: 'the-chariot',
      name: 'The Chariot',
      number: 7,
      keywords: ['willpower', 'determination', 'control', 'victory'],
      strengths: [
        { label: 'Control', description: 'The ability to harness opposing forces', symbol: '‚ö°' },
        { label: 'Initiative', description: 'Taking decisive action', symbol: 'üéØ' },
        { label: 'Momentum', description: 'Using forward motion to maintain progress', symbol: 'üî•' }
      ],
      weaknesses: [
        { label: 'Rigidity', description: 'Being too focused on the destination', symbol: '‚õìÔ∏è' },
        { label: 'Burnout', description: 'Pushing too hard', symbol: 'üí•' },
        { label: 'Aggression', description: 'Letting drive override compassion', symbol: '‚öîÔ∏è' }
      ]
    };

    const casperContent = {
      dailyDrawIntro: `<h4>Here's the deal:</h4>
<p>The Chariot is about taking the wheel and actually driving. Not planning to drive. Not thinking about driving. <strong>Driving.</strong></p>

<div class="action-box">
<strong>Your Move Today:</strong>
<ul>
<li>Identify one thing you've been circling.</li>
<li>Make a decision about it.</li>
<li>Take the first action‚Äîeven if it's small.</li>
</ul>
</div>

<h4>What to Watch:</h4>
<p>Don't confuse movement with progress. The Chariot isn't about going fast‚Äîit's about going <strong>forward.</strong> Big difference.</p>

<p>If you're pushing and nothing's moving? You're either pushing in the wrong direction or you need to align your internal forces first. Stop. Assess. Adjust.</p>

<h4>Bottom Line:</h4>
<p>You know what needs to happen. Now go.</p>`,
      
      affirmation: "I MOVE WITH PURPOSE. I TRUST MY DIRECTION."
    };

    const questionChips = [
      { id: 'love', text: "What about love?", icon: '‚ù§Ô∏è' },
      { id: 'stuck', text: "I'm stuck. Help.", icon: 'üöß' },
      { id: 'career', text: "Career application?", icon: 'üíº' }
    ];

    const responses = {
      love: {
        message: "Love. The Chariot.\n\nHere's what this means: Stop waiting for the other person to make a move. Stop hoping things will magically get clearer. If you want something, say it. If you need something, ask for it. If something isn't working, address it.\n\nThe Control strength here? It's about being clear on what you want and moving toward it with intention. Not manipulation‚Äîintention.\n\nThe trap? Trying to control HOW it unfolds. You can control your direction and your actions. You can't control their response. Accept that or you'll drive yourself insane.\n\nSo: What do you actually want? And what's one honest conversation you've been avoiding?",
        xp: 2
      },
      stuck: {
        message: "Stuck? Good. Let's fix it.\n\nFirst: Are you actually stuck, or are you just scared to move?\n\nBecause The Chariot showing up means the path is there. You might not like the path. It might be hard. But it's there.\n\nHere's what's probably happening: You're waiting for more information. More certainty. The \"perfect moment.\" None of that is coming. You already have enough to take the next step.\n\nSo here's your assignment:\n‚ñ∏ Write down the three actions you KNOW you should take\n‚ñ∏ Pick the smallest one\n‚ñ∏ Do it today\n\nMovement creates clarity. Not the other way around.",
        xp: 3
      },
      career: {
        message: "Career + The Chariot = It's time to lead.\n\nEven if you're not \"leadership level\" yet. Even if you don't have the title. Leadership is a decision, not a permission slip.\n\nThis card is telling you:\n‚ñ∏ Stop waiting to be given opportunities‚Äîcreate them\n‚ñ∏ Stop asking for permission‚Äîshow results\n‚ñ∏ Stop hoping someone notices‚Äîmake your work undeniable\n\nThe Initiative strength is your superpower right now. Use it.\n\nWarning: Don't steamroll your team to get ahead. The best leaders bring people with them. Channel that Momentum into lifting others while you rise.\n\nWhat's the one project you could take ownership of right now?",
        xp: 2
      }
    };

    // Event handlers
    function nextStage(newStage) {
      stage = newStage;
      render();
    }

    function goBack() {
      stage = 'interpretation';
      render();
    }

    function saveReading() {
      const reading = {
        date: new Date().toISOString(),
        card: drawnCard,
        avatar: 'casper',
        conversation: conversation,
        xp: relationshipXP
      };
      
      localStorage.setItem('lastReading', JSON.stringify(reading));
      isSaved = true;
      render();
      
      setTimeout(() => {
        alert('‚úì SAVED. CHECK YOUR JOURNAL.');
      }, 100);
    }

    function handleChipClick(chipId) {
      const chip = questionChips.find(c => c.id === chipId);
      const response = responses[chipId];
      
      conversation.push(
        { speaker: 'user', text: chip.text },
        { speaker: 'casper', text: response.message, xp: response.xp }
      );
      relationshipXP += response.xp;
      
      nextStage('conversation');
    }

    function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input ? input.value.trim() : '';
      
      if (!message) return;
      
      conversation.push({ speaker: 'user', text: message });
      render();
      
      setTimeout(() => {
        conversation.push({
          speaker: 'casper',
          text: "Keep going. What's the real question?",
          xp: 1
        });
        relationshipXP += 1;
        render();
      }, 1000);
    }

    // Render functions
    function renderWelcome() {
      return `
        <div class="container">
          <div class="header">
            <div class="avatar-icon">üî•</div>
            <div class="avatar-info">
              <h2>Casper</h2>
              <p>Fire Guide ‚Ä¢ Level 1</p>
            </div>
          </div>

          <div class="content">
            <div class="message-box">
              <p>I'm Casper. I don't do fluff.</p>
              <p>The cards won't tell you what to do. They'll show you what you already know but won't admit. My job? <strong>Make you admit it.</strong></p>
              <p>If you want someone to validate your excuses, I'm not your person. If you want clarity and a push forward? Let's go.</p>
            </div>

            <button class="btn-primary" onclick="nextStage('shuffling')">DRAW CARD</button>
          </div>
        </div>
      `;
    }

    function renderShuffling() {
      setTimeout(() => nextStage('card-reveal'), 2000);
      return `
        <div class="shuffling-screen">
          <div class="shuffling-card"></div>
          <p class="shuffling-text">Shuffling...</p>
        </div>
      `;
    }

    function renderCardReveal() {
      return `
        <div class="container">
          <div class="header">
            <div class="avatar-icon">üî•</div>
            <div class="avatar-info">
              <h2>Casper</h2>
              <p>Fire Guide ‚Ä¢ Level 1</p>
            </div>
          </div>

          <div class="content">
            <div class="card-display">
              <div class="card-content">
                <p class="card-number">VII</p>
                <p class="card-name">THE CHARIOT</p>
              </div>
            </div>

            <div class="card-info">
              <h3>The Chariot</h3>
              <div class="keywords">
                ${drawnCard.keywords.map(k => `<span class="keyword">${k}</span>`).join('')}
              </div>
            </div>

            <button class="btn-primary" onclick="nextStage('interpretation')">WHAT THIS MEANS</button>
          </div>
        </div>
      `;
    }

    function renderInterpretation() {
      return `
        ${!isFirstTime ? `
        <button class="save-button ${isSaved ? 'saved' : ''}" onclick="saveReading()">
          <span class="save-icon">${isSaved ? '‚úì' : '‚ô°'}</span>
          <span>${isSaved ? 'SAVED' : 'SAVE'}</span>
        </button>
        ` : ''}
        
        <div class="container">
          <div class="header">
            <div class="avatar-icon">üî•</div>
            <div class="avatar-info">
              <h2>Casper</h2>
              <p>Fire Guide ‚Ä¢ Level 1</p>
            </div>
          </div>

          <div class="scrollable">
            <div class="mini-card">
              <div class="mini-card-img">VII</div>
              <div class="mini-card-info">
                <h3>The Chariot</h3>
                <p>Card 7 of 22 ‚Ä¢ Major Arcana</p>
              </div>
            </div>

            <div class="interpretation-box">
              <div class="casper-message">${casperContent.dailyDrawIntro}</div>
            </div>

            <div class="strengths-box">
              <h4>‚ñ∏ LEAN INTO</h4>
              ${drawnCard.strengths.map(s => `
                <div class="item">
                  <div class="item-header">
                    <span class="symbol">${s.symbol}</span>
                    <p>${s.label}</p>
                  </div>
                  <div class="item-content">
                    <p>${s.description}</p>
                  </div>
                </div>
              `).join('')}
              
              <h4 style="margin-top: 1.5rem;">‚ñ∏ WATCH FOR</h4>
              ${drawnCard.weaknesses.map(w => `
                <div class="item">
                  <div class="item-header">
                    <span class="symbol">${w.symbol}</span>
                    <p>${w.label}</p>
                  </div>
                  <div class="item-content">
                    <p>${w.description}</p>
                  </div>
                </div>
              `).join('')}
            </div>

            <div class="affirmation-box">
              <p>${casperContent.affirmation}</p>
            </div>
          </div>

          <div class="chips-section">
            <p class="chips-label">Ask if you need to</p>
            ${questionChips.map(chip => `
              <button class="chip" onclick="handleChipClick('${chip.id}')">
                <span class="chip-icon">${chip.icon}</span>
                <span class="chip-text">${chip.text}</span>
              </button>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderConversation() {
      return `
        ${!isFirstTime ? `
        <button class="save-button ${isSaved ? 'saved' : ''}" onclick="saveReading()">
          <span class="save-icon">${isSaved ? '‚úì' : '‚ô°'}</span>
          <span>${isSaved ? 'SAVED' : 'SAVE'}</span>
        </button>
        ` : ''}
        
        <div class="container">
          <button class="back-button" onclick="goBack()">
            <span>‚Üê</span>
            <span>Back</span>
          </button>
          
          <div class="conversation-header">
            <div class="header" style="margin: 0;">
              <div class="avatar-icon">üî•</div>
              <div class="avatar-info">
                <h2>Casper</h2>
                <p>Fire Guide ‚Ä¢ Level 1</p>
              </div>
            </div>
            <div class="xp-display">
              <p>XP</p>
              <p>${relationshipXP}</p>
            </div>
          </div>

          <div class="conversation-thread">
            <div class="context-card">
              <p>Your Card</p>
              <p>The Chariot</p>
            </div>

            ${conversation.map(msg => `
              <div class="message ${msg.speaker}">
                <div class="message-bubble">
                  <p class="message-text">${msg.text}</p>
                  ${msg.xp ? `<p class="xp-badge">+${msg.xp} XP</p>` : ''}
                </div>
              </div>
            `).join('')}
          </div>

          <div class="chips-section" style="margin-bottom: 1rem;">
            ${questionChips.filter(chip => !conversation.some(msg => msg.text === chip.text)).map(chip => `
              <button class="chip" onclick="handleChipClick('${chip.id}')">
                <span class="chip-icon">${chip.icon}</span>
                <span class="chip-text">${chip.text}</span>
              </button>
            `).join('')}
          </div>

          <div class="input-area">
            <input 
              type="text" 
              class="input-field" 
              placeholder="Type your question..."
              id="messageInput"
              onkeypress="if(event.key==='Enter') sendMessage()"
            />
            <button class="send-btn" onclick="sendMessage()">
              ‚Üí
            </button>
          </div>
        </div>
      `;
    }

    // Main render
    function render() {
      const app = document.getElementById('app');
      
      switch(stage) {
        case 'welcome':
          app.innerHTML = renderWelcome();
          break;
        case 'shuffling':
          app.innerHTML = renderShuffling();
          break;
        case 'card-reveal':
          app.innerHTML = renderCardReveal();
          break;
        case 'interpretation':
          app.innerHTML = renderInterpretation();
          break;
        case 'conversation':
          app.innerHTML = renderConversation();
          break;
      }
    }

    // Initial render
    render();
  </script>
</body>
</html>
